<!DOCTYPE html>
<html>
	<head>
	
		<title>StackOverflow Favorites Organizer</title>
		<link type="text/css" href="css/ui-lightness/jquery-ui-1.8.13.custom.css" rel="stylesheet" />	
		<script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.8.13.custom.min.js"></script>
		<link type="text/css" rel="Stylesheet" href="http://infinity88.com/stackunderflow/stackoverflow.min.css" />
		<script type="text/javascript" src="http://infinity88.com/stackunderflow/stackunderflow-1.0.3.min.js"></script>
		
		<script type="text/javascript">
			var tags = {};
			var userID = '340';
			
			$(document).ready(function () {
				$('#userIDForm').submit(function() {
					userID = $('#userID').val();
					
					getFavoriteQuestions();
					
					return false;
				});			
			
				$('.expand').live('click', function(event) {
					var $expandLink = $(this);
					
					$(this).next().toggle('slow', function() {
						
						if($expandLink.text() == '+') {
							$expandLink.html('&minus;');
							$expandLink.addClass('red');
						} else {
							$expandLink.text('+');
							$expandLink.removeClass('red');
						}
					});
					
					event.stopPropagation();
					event.preventDefault();
				});
				
				$('.questionContent').hide();
			
				$('#folders').sortable();
			
				getFavoriteQuestions();				
					
			});
			
		function getFavoriteQuestions() {
			//Reset html and tags variable
			tags = {};
			$('#folders').html('');
		
			var flairHtml = '<a href="http://stackoverflow.com/users/'+userID+'/"><img src="http://stackoverflow.com/users/flair/'+userID+'.png"></a>';
			$('#userFlair').html(flairHtml);
			
				
			$.getJSON('http://api.stackoverflow.com/1.1/users/'+userID+'/favorites?jsonp=?',
				{
					pagesize: '100'
				},
				function(data) {
					$.each(data.questions, function(index, question) {
					
						$.each(question.tags, function(index, tag) {
							if(tags[tag]) {
								tags[tag].questions.push(question);
							} else {
								tags[tag] = { "questions": [ question ] };
							}
						});
					
					});
					
					//Show a folder for each tag with the right questions in it
					$.each(tags, function(tagName, tagQuestions) {
						var tagContainerHtml = '<li class="ui-widget-content"><span class="folderName">'+tagName+'</span> <a class="expand">+</a><div id="'+tagName+'_tagContainer"class="tagQuestions" style="display: none;"></div><div style="clear:both;"></div></li>';
						
						$('#folders').append(tagContainerHtml);
						
						stackunderflow.render.questions(tagQuestions, '#'+tagName+'_tagContainer');
					});
					
				});
		}
		
		</script>
		
		<style>
			#folders .ui-selecting { background: #FECA40; }
			#folders .ui-selected { background: #F39814; color: white; }
			#folders { list-style-type: none; margin: 0; padding: 0; }
			#folders li { margin: 3px; padding: 0.4em; }
			#folders li .folderName { font-size: 1.4em; }
			#folders li .expand { color: green; }
			#folders li .red { color: red; }
		</style>
		
	</head>
	<body>
	
		<form id="userIDForm">
			User ID: <input type="text" id="userID" />
			<input type="submit" value="Submit" />
		</form> 
		
		<div id="userFlair">
		
		</div>
		
		<ul id="folders">

		</ul>
	</body>
</html>


